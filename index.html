<!DOCTYPE html>

<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø³Ø§Ù…Ø§Ù†Ù‡ ØªÚ©Ø§Ù„ÛŒÙ Ù…Ø¹Ù„Ù…-Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: ui-sans-serif, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif; }
    .card { @apply bg-white rounded-2xl shadow p-5; }
    .btn { @apply rounded-xl px-4 py-2 font-medium shadow; }
    .btn-primary { @apply bg-indigo-600 text-white hover:bg-indigo-700; }
    .btn-ghost { @apply bg-gray-100 hover:bg-gray-200; }
    .input { @apply w-full rounded-xl border border-gray-300 p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400; }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <header class="sticky top-0 z-10 bg-white/80 backdrop-blur border-b">
    <div class="max-w-6xl mx-auto flex items-center justify-between p-4">
      <h1 class="text-xl font-bold">ğŸ“ Ø³Ø§Ù…Ø§Ù†Ù‡ ØªÚ©Ø§Ù„ÛŒÙ Ù…Ø¹Ù„Ù…-Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</h1>
      <nav class="flex gap-2 text-sm">
        <button class="btn btn-ghost" onclick="switchView('home')">Ø®Ø§Ù†Ù‡</button>
        <button class="btn btn-ghost" onclick="switchView('teacherAuth')">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…/ÙˆØ±ÙˆØ¯ Ù…Ø¹Ù„Ù…</button>
        <button class="btn btn-ghost" onclick="switchView('studentSubmit')">Ø§Ø±Ø³Ø§Ù„ ØªÚ©Ù„ÛŒÙ</button>
        <button class="btn btn-ghost" onclick="switchView('studentView')">ÙˆØ¶Ø¹ÛŒØª ØªÚ©Ø§Ù„ÛŒÙ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</button>
        <button class="btn btn-ghost" onclick="switchView('teacherDashboard')">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¹Ù„Ù…</button>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto p-4 grid gap-6">
    <!-- Ø®Ø§Ù†Ù‡ -->
    <section id="view-home" class="card">
      <h2 class="text-xl font-bold mb-3">Ø¨Ù‡ Ø³Ø§Ù…Ø§Ù†Ù‡ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯</h2>
      <p class="text-gray-700">Ù…Ø¹Ù„Ù… Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ùˆ ØªÚ©Ø§Ù„ÛŒÙ Ø±Ø§ Ù…Ø´Ø®Øµ Ù…ÛŒâ€ŒØ³Ø§Ø²Ø¯. Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù¾Ø§Ø³Ø® Ù…ØªÙ†ÛŒ ÛŒØ§ Ø¹Ú©Ø³ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†Ø¯. Ù…Ø¹Ù„Ù… Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨Ø§Ø²Ø®ÙˆØ±Ø¯ Ùˆ Ù†Ù…Ø±Ù‡ Ø¨Ø¯Ù‡Ø¯ Ùˆ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø± Ø¨Ø®Ø´ Â«ÙˆØ¶Ø¹ÛŒØª ØªÚ©Ø§Ù„ÛŒÙÂ» Ù†ØªÛŒØ¬Ù‡â€ŒÛŒ Ø®ÙˆØ¯Ø´ Ø±Ø§ Ø¨Ø¨ÛŒÙ†Ø¯.</p>
    </section>

```
<!-- Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…/ÙˆØ±ÙˆØ¯ Ù…Ø¹Ù„Ù… -->
<section id="view-teacherAuth" class="card hidden">
  <h2 class="text-xl font-bold mb-4">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… / ÙˆØ±ÙˆØ¯ Ù…Ø¹Ù„Ù…</h2>
  <form id="signupForm" class="grid gap-3 mb-4">
    <input class="input" name="name" placeholder="Ù†Ø§Ù… Ù…Ø¹Ù„Ù…" required />
    <input class="input" name="username" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ" required />
    <input class="input" name="password" type="password" placeholder="Ø±Ù…Ø²" required />
    <textarea class="input" name="students" rows="3" placeholder="Ø§Ø³Ø§Ù…ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¨Ø§ Ú©Ø§Ù…Ø§ Ø¬Ø¯Ø§ Ú©Ù†ÛŒØ¯" required></textarea>
    <button class="btn btn-primary" type="submit">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</button>
  </form>
  <form id="loginForm" class="grid gap-3">
    <input class="input" name="username" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ" required />
    <input class="input" name="password" type="password" placeholder="Ø±Ù…Ø²" required />
    <button class="btn btn-primary" type="submit">ÙˆØ±ÙˆØ¯</button>
  </form>
  <p class="mt-3 text-sm text-gray-600">ÙˆØ¶Ø¹ÛŒØª: <span id="authStatus">Ø®Ø§Ø±Ø¬ Ø§Ø² Ø³ÛŒØ³ØªÙ…</span></p>
</section>

<!-- Ø§Ø±Ø³Ø§Ù„ ØªÚ©Ù„ÛŒÙ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² -->
<section id="view-studentSubmit" class="card hidden">
  <h2 class="text-xl font-bold mb-4">Ø§Ø±Ø³Ø§Ù„ ØªÚ©Ù„ÛŒÙ</h2>
  <form id="studentForm" class="grid gap-3">
    <input class="input" name="studentName" placeholder="Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²" required />
    <select class="input" name="teacher" id="studentTeacherSelect" required></select>
    <select class="input" name="assignment" id="studentAssignmentSelect" required></select>
    <textarea class="input" name="content" rows="3" placeholder="Ù¾Ø§Ø³Ø® Ù…ØªÙ†ÛŒ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)"></textarea>
    <input class="input" type="file" name="image" accept="image/*" />
    <button class="btn btn-primary" type="submit">Ø§Ø±Ø³Ø§Ù„</button>
  </form>
</section>

<!-- ÙˆØ¶Ø¹ÛŒØª ØªÚ©Ø§Ù„ÛŒÙ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² -->
<section id="view-studentView" class="card hidden">
  <h2 class="text-xl font-bold mb-4">ÙˆØ¶Ø¹ÛŒØª ØªÚ©Ø§Ù„ÛŒÙ</h2>
  <form id="studentCheckForm" class="grid gap-3 mb-4">
    <input class="input" name="studentName" placeholder="Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²" required />
    <select class="input" name="teacher" id="checkTeacherSelect" required></select>
    <button class="btn btn-primary" type="submit">Ù…Ø´Ø§Ù‡Ø¯Ù‡</button>
  </form>
  <div id="studentAssignments"></div>
</section>

<!-- Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¹Ù„Ù… -->
<section id="view-teacherDashboard" class="card hidden">
  <h2 class="text-xl font-bold mb-4">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¹Ù„Ù…</h2>
  <div>ÙˆØ±ÙˆØ¯: <span id="currentTeacher">-</span></div>
  <form id="createAssignmentForm" class="grid gap-3 my-4">
    <input class="input" name="title" placeholder="Ø¹Ù†ÙˆØ§Ù† ØªÚ©Ù„ÛŒÙ" required />
    <button class="btn btn-primary" type="submit">Ø§ÛŒØ¬Ø§Ø¯</button>
  </form>
  <select id="assignmentPicker" class="input mb-3"></select>
  <table class="min-w-full border rounded">
    <thead><tr><th class="p-2">Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</th><th class="p-2">ÙˆØ¶Ø¹ÛŒØª</th><th class="p-2">Ù¾Ø§Ø³Ø®</th><th class="p-2">Ø¹Ú©Ø³</th><th class="p-2">Ø¨Ø§Ø²Ø®ÙˆØ±Ø¯</th><th class="p-2">Ù†Ù…Ø±Ù‡</th><th class="p-2">Ø«Ø¨Øª</th></tr></thead>
    <tbody id="submissionsBody"></tbody>
  </table>
</section>
```

  </main>

  <script>
    const supabaseUrl = 'https://qockhofltrxkynquncwo.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFvY2tob2ZsdHJ4a3lucXVuY3dvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzOTk2MDgsImV4cCI6MjA3OTk3NTYwOH0.TqMtW4LO04C4jhcR5GC4FnS-Fvx_LNQNS1zA5VDpDwc';
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    let currentUser = null;

    function switchView(id){
      document.querySelectorAll('main > section').forEach(s=>s.classList.add('hidden'));
      document.getElementById('view-'+id).classList.remove('hidden');
      if(id==='studentSubmit') refreshStudentFormChoices();
      if(id==='studentView') refreshCheckChoices();
      if(id==='teacherDashboard') renderDashboard();
      if(id==='teacherAuth') updateAuthStatus();
    }

    async function updateAuthStatus(){
      document.getElementById('authStatus').textContent = currentUser ? `ÙˆØ§Ø±Ø¯ (${currentUser})` : 'Ø®Ø§Ø±Ø¬';
    }

    async function fetchTeachers(){
      const { data } = await supabase.from('teachers').select('*');
      return data || [];
    }

    async function refreshStudentFormChoices(){
      const teachers = await fetchTeachers();
      const sel = document.getElementById('studentTeacherSelect');
      sel.innerHTML = '<option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø¹Ù„Ù…</option>';
      teachers.forEach(t=>{sel.innerHTML+=`<option value="${t.username}">${t.name}</option>`});
      refreshAssignmentChoices();
    }

    async function refreshAssignmentChoices(){
      const teacherUsername = document.getElementById('studentTeacherSelect').value;
      const { data: teacher } = await supabase.from('teachers').select('assignments').eq('username', teacherUsername).single();
      const sel = document.getElementById('studentAssignmentSelect');
      sel.innerHTML = '<option value="">Ø§Ù†ØªØ®Ø§Ø¨ ØªÚ©Ù„ÛŒÙ</option>';
      if(!teacher || !teacher.assignments) return;
      Object.entries(teacher.assignments).forEach(([id, a]) => {
        sel.innerHTML += `<option value="${id}">${a.title}</option>`;
      });
    }

    // TODO: Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§ÛŒØ¯ Ú©Ø¯Ù‡Ø§ÛŒ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…ØŒ ÙˆØ±ÙˆØ¯ØŒ Ø§ÛŒØ¬Ø§Ø¯ ØªÚ©Ù„ÛŒÙØŒ Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø®ØŒ Ø¯Ø±ÛŒØ§ÙØª Ø¨Ø§Ø²Ø®ÙˆØ±Ø¯ Ùˆ Ù†Ù…Ø±Ù‡ Ø¨Ø§ Supabase Ø§Ø¶Ø§ÙÙ‡ Ø´ÙˆØ¯.

    switchView('home');
    refreshStudentFormChoices();
    refreshCheckChoices();
  </script>

</body>
</html>
